var C=Object.defineProperty;var x=(e,t,o)=>t in e?C(e,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):e[t]=o;var h=(e,t,o)=>x(e,typeof t!="symbol"?t+"":t,o);import{b as D,U as M,c as P,ap as j,l as B,h as N,d as $,aq as q,ar as F,as as Y,at as G,am as U,I as O,J as _,q as y}from"./eZGv4jwx.js";import{_ as K}from"./Dqzq9lYN.js";function it(e,t,...o){var n=e,s=j,r;D(()=>{s!==(s=t())&&(r&&(B(r),r=null),r=P(()=>s(n,...o)))},M),N&&(n=$)}const J=Symbol("is custom element"),H=Symbol("is html");function at(e,t,o,n){var s=Q(e);N&&(s[t]=e.getAttribute(t),t==="src"||t==="srcset"||t==="href"&&e.nodeName==="LINK")||s[t]!==(s[t]=o)&&(t==="loading"&&(e[G]=o),o==null?e.removeAttribute(t):typeof o!="string"&&z(e).includes(t)?e[t]=o:e.setAttribute(t,o))}function Q(e){return e.__attributes??(e.__attributes={[J]:e.nodeName.includes("-"),[H]:e.namespaceURI===q})}var b=new Map;function z(e){var t=b.get(e.nodeName);if(t)return t;b.set(e.nodeName,t=[]);for(var o,n=e,s=Element.prototype;s!==n;){o=Y(n);for(var r in o)o[r].set&&t.push(r);n=F(n)}return t}const L=new Map,V=(e,t)=>{if(L.has(e))return L.get(e);let o=U(O({type:e,data:t,error:void 0}));const n={is(s){const{data:r}=y(o);return r===s},get value(){return y(o).data},set value(s){_(o,{type:e,data:s},!0)},get error(){return y(o).error},set error(s){_(o,{type:e,error:s},!0)},clear(){_(o,{type:e},!0)}};return L.set(e,n),n},p={KEY:"NetworkState",save(e){typeof window>"u"||sessionStorage.setItem(p.KEY,e)},restore(){if(typeof window>"u")return!0;const e=sessionStorage.getItem(p.KEY);return e?e==="true":!1}},v=O({online:p.restore()});let k=U(!1);const T=()=>{navigator.onLine?(console.log("online"),v.online=!0,p.save("true"),y(k)&&location.reload()):(console.log("offline"),v.online=!1,p.save("false"))},W=()=>{typeof window>"u"||(window.addEventListener("online",T),window.addEventListener("offline",T),v.online||T())};W();const E={get status(){return v},qeueuRefresh(){_(k,!0)}},X=async e=>{try{const t=await K(()=>import("./BlRhkrN0.js"),[],import.meta.url),{io:o}=t,{BASE_URL:n,DEBUG:s,realTime:r=void 0}=e.config,d=o(`${n}`,r);return d.on("connect",function(){e.sync=function(l,a,f){return E.status.online?new Promise(g=>{try{const u={...f,__client_time:new Date().toISOString()};d.emit(a,{path:l,data:u},i=>{const{status:c,body:w}=i,m={status:c,...w||{}};s&&console.log("IO: ","result: ",i,"path: ",l,"method: ",a," args: ",u),g(m)})}catch(u){s&&console.log("IO: ","error: ",u.toString(),"path: ",l,"method: ",a," args: ",f),g({error:u.toString(),status:500})}}):(E.qeueuRefresh(),Promise.resolve({error:"You seem to be offline :)",status:404}))}}),d.on("comets",e.onComets),d}catch(t){console.log("RealTime initialization error: ",t)}},R=function(e){if(e=e+"",e.indexOf("_")<0)return e==="id"?e.toUpperCase():e.charAt(0).toUpperCase()+e.substring(1);const o=e.split("_");let n="";return o.forEach(function(s){n+=n.length>0?" "+R(s):R(s)}),n},Z=e=>{if(!e)return"";const t={},o=[];for(const[s,r]of Object.entries(e))typeof r=="object"?o.push(`${s}=${encodeURIComponent(JSON.stringify(r))}`):t[s]=r;const n=new URLSearchParams(t).toString();return o.length<1?n:n?`${n}&${o.join("&")}`:o.join("&")},ct=(e,t)=>{let o;return(...n)=>{clearTimeout(o),o=setTimeout(()=>{e(...n)},t)}},ft=e=>{e["x-api-key"]="reqres-free-v1"},tt={FormURLEncoded:"application/x-www-form-urlencoded"},S={},et="loading",I=e=>async(t,o,n=void 0)=>{if(!E.status.online)return E.qeueuRefresh(),Promise.resolve({error:"You seem to be offline :)",status:404});const s=o.toLowerCase()==="upload",{BASE_URL:r,init:d={},beforeSend:l}=e.config,a={...d};let{fetch:f}=e.config;if(r||console.warn("You did not set the BASE_URL on Transport before invoking methods; this might break your requests. I hope this is deliberate and you are passing url as FQDN plus paths."),!f&&typeof window<"u"&&(f=window.fetch),!f)return Promise.resolve({error:"You seem to be invoking methods on Transport from server; pass down fetch from your view +page.[t/j]s :)",status:500});const g=["post","put","upload"].includes(o.toLowerCase());if(l(a.headers),!g)t=n?[t,new URLSearchParams(n).toString()].join("?"):t,a.method=o;else if(s){const i=n;i.append("__client_time",new Date().toISOString());const{["content-type"]:c,...w}=a.headers||{};a.headers=w,a.body=i,a.method=i!=null&&i.id?"put":"post"}else{const{["content-type"]:i}=a.headers||{};a.method=o;const c={...n||{},__client_time:new Date().toISOString()};a.body=JSON.stringify(c),i===tt.FormURLEncoded&&(a.body=Z(c))}const u=`${r}${t}`;e.loading.value=!0;try{const i=await f(u,a),c=i.status;if(!i.ok){const m=`${t} - ${i.statusText}`;return console.log("Error: ",m),{error:m,status:c}}return{...await i.json(),status:c}}catch(i){const c=i.toString();return console.log("Fetch error: ",c),{error:"Fetch error",status:500}}};class A{constructor(t){h(this,"loading",V(et,!1));h(this,"cometListeners",{});h(this,"config",{BASE_URL:"",DEBUG:!1,fetch:typeof window>"u"?void 0:window.fetch,init:{method:"GET",mode:"cors",credentials:"same-origin",headers:{"content-type":"application/json"}},beforeSend:()=>{}});h(this,"socket",null);this.config={...this.config,...t}}async fetch(t,o,n=void 0){return I(this)(t,o,n)}async sync(t,o,n=void 0){return I(this)(t,o,n)}destroy(){this.sync=I(this),this.socket=null}async switchToRealTime(){const{realTime:t}=this.config;t&&!this.socket&&(this.socket=await X(this))}onCometsNotify(t){const o=this.cometListeners[t.store]||[];o.find(n=>n.listenerID===t.listenerID)||(o.push(t),this.cometListeners[t.store]=o)}stopCometsOn(t){const o=this.cometListeners[t.store]||[];if(!o.length)return;const n=o.filter(s=>s.listenerID!==t.listenerID);this.cometListeners[t.store]=n}onComets(t){const{DEBUG:o}=this.config;o&&console.log("IO: ","oncomets: ",t.room,t.verb,t.data);const n=this.cometListeners[t.room]||[];n.length&&n.forEach(s=>s.onComets(t))}async upload(t,o){return await this.fetch(t,"upload",o)}async post(t,o){return await this.fetch(t,"post",o)}async get(t,o){return await this.fetch(t,"get",o)}async patch(t,o){return await this.fetch(t,"patch",o)}async put(t,o){return await this.fetch(t,"put",o)}async options(t,o){return await this.fetch(t,"options",o)}async delete(t,o){return await this.fetch(t,"delete",o)}}const ot=new A({});S.default=ot;const ut={configure(e){e.context||(e.context="default");const t=new A(e);return S[e.context]=t,t},instance(e){if(["string","undefined"].includes(typeof e)){const t=e||"default",o=S[t];if(!o)throw Error("Invalid transport context: "+t);return o}else{const{fetch:t,context:o="default",beforeSend:n}=e,s=S[o];if(!s)throw Error("Invalid transport context: "+o);return t&&(s.config.fetch=t),n&&(s.config.beforeSend=n),s}}};export{ut as T,at as a,ft as b,ct as d,R as m,E as n,it as s};
