var U=Object.defineProperty;var b=(s,t,e)=>t in s?U(s,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[t]=e;var d=(s,t,e)=>b(s,typeof t!="symbol"?t+"":t,e);import{b as D,U as M,c as O,ai as P,l as B,h as R,d as Y,aj as x,ak as F,al as q,am as j,an as N,I as k,J as w,q as m}from"./Dah7JrHO.js";import{_ as G}from"./CULLAqQ3.js";function et(s,t,...e){var o=s,r=P,n;D(()=>{r!==(r=t())&&(n&&(B(n),n=null),n=O(()=>r(o,...e)))},M),R&&(o=Y)}const $=Symbol("is custom element"),K=Symbol("is html");function st(s,t,e,o){var r=H(s);R&&(r[t]=s.getAttribute(t),t==="src"||t==="srcset"||t==="href"&&s.nodeName==="LINK")||r[t]!==(r[t]=e)&&(t==="loading"&&(s[j]=e),e==null?s.removeAttribute(t):typeof e!="string"&&J(s).includes(t)?s[t]=e:s.setAttribute(t,e))}function H(s){return s.__attributes??(s.__attributes={[$]:s.nodeName.includes("-"),[K]:s.namespaceURI===x})}var I=new Map;function J(s){var t=I.get(s.nodeName);if(t)return t;I.set(s.nodeName,t=[]);for(var e,o=s,r=Element.prototype;r!==o;){e=q(o);for(var n in e)e[n].set&&t.push(n);o=F(o)}return t}const E=new Map,z=(s,t)=>{if(E.has(s))return E.get(s);let e=N(k({type:s,data:t,error:void 0}));const o={is(r){const{data:n}=m(e);return n===r},get value(){return m(e).data},set value(r){w(e,{type:s,data:r},!0)},get error(){return m(e).error},set error(r){w(e,{type:s,error:r},!0)},clear(){w(e,{type:s},!0)}};return E.set(s,o),o},l={KEY:"NetworkState",save(s){typeof window>"u"||sessionStorage.setItem(l.KEY,s)},restore(){if(typeof window>"u")return!0;const s=sessionStorage.getItem(l.KEY);return s?s==="true":!1}},y=k({online:l.restore()});let A=N(!1);const T=()=>{navigator.onLine?(console.log("online"),y.online=!0,l.save("true"),m(A)&&location.reload()):(console.log("offline"),y.online=!1,l.save("false"))},Q=()=>{typeof window>"u"||(window.addEventListener("online",T),window.addEventListener("offline",T),y.online||T())};Q();const _={get status(){return y},qeueuRefresh(){w(A,!0)}},V=async s=>{try{const t=await G(()=>import("./BlRhkrN0.js"),[],import.meta.url),{io:e}=t,{BASE_URL:o,DEBUG:r,realTime:n=void 0}=s.config,a=e(`${o}`,n);return a.on("connect",function(){s.sync=function(c,u,h){return _.status.online?new Promise(f=>{try{a.emit(u,{path:c,data:h},i=>{const{status:p,body:S}=i,g={status:p,...S||{}};r&&console.log("IO: ","result: ",i,"path: ",c,"method: ",u," args: ",h),f(g)})}catch(i){r&&console.log("IO: ","error: ",i.toString(),"path: ",c,"method: ",u," args: ",h),f({error:i.toString(),status:500})}}):(_.qeueuRefresh(),Promise.resolve({error:"You seem to be offline :)",status:404}))}}),a.on("comets",s.onComets),a}catch(t){console.log("RealTime initialization error: ",t)}},v={},L=s=>async(t,e,o=void 0)=>{if(!_.status.online)return _.qeueuRefresh(),Promise.resolve({error:"You seem to be offline :)",status:404});const{BASE_URL:r,init:n}=s.config;let{fetch:a}=s.config;if(r||console.warn("You did not set the BASE_URL on Transport before invoking methods; this might break your requests. I hope this is deliberate and you are passing url as FQDN plus paths."),!a&&typeof window<"u"&&(a=window.fetch),!a)return Promise.resolve({error:"You seem to be invoking methods on Transport from server; pass down fetch from your view +page.[t/j]s :)",status:500});const c=["post","put"].includes(e.toLowerCase());c||(t=o?[t,new URLSearchParams(o).toString()].join("?"):t);const u=`${r}${t}`,h=c?JSON.stringify(o||{}):void 0;s.loading.value=!0;try{const f={...n,method:e,body:h},i=await a(u,f),p=i.status;if(!i.ok){const g=`${t} - ${i.statusText}`;return console.log("Error: ",g),{error:g,status:p}}return{...await i.json(),status:p}}catch(f){const i=f.toString();return console.log("Fetch error: ",i),{error:"Fetch error",status:500}}};class C{constructor(t){d(this,"loading",z("loading",!1));d(this,"cometListeners",{});d(this,"config",{BASE_URL:"",DEBUG:!1,fetch:typeof window>"u"?void 0:window.fetch,init:{method:"GET",mode:"cors",credentials:"same-origin",headers:{"Content-Type":"application/json; charset=UTF-8"}}});d(this,"socket",null);this.config={...this.config,...t}}async fetch(t,e,o=void 0){return L(this)(t,e,o)}async sync(t,e,o=void 0){return L(this)(t,e,o)}destroy(){this.sync=L(this),this.socket=null}async switchToRealTime(){const{realTime:t}=this.config;t&&!this.socket&&(this.socket=await V(this))}onCometsNotify(t){const e=this.cometListeners[t.store]||[];e.find(o=>o.listenerID===t.listenerID)||(e.push(t),this.cometListeners[t.store]=e)}stopCometsOn(t){const e=this.cometListeners[t.store]||[];if(!e.length)return;const o=e.filter(r=>r.listenerID!==t.listenerID);this.cometListeners[t.store]=o}onComets(t){const{DEBUG:e}=this.config;e&&console.log("IO: ","oncomets: ",t.room,t.verb,t.data);const o=this.cometListeners[t.room]||[];o.length&&o.forEach(r=>r.onComets(t))}async upload(t,e){return await this.fetch(t,"POST",e)}async post(t,e){return await this.fetch(t,"post",e)}async get(t,e){return await this.fetch(t,"get",e)}async patch(t,e){return await this.fetch(t,"patch",e)}async put(t,e){return await this.fetch(t,"put",e)}async options(t,e){return await this.fetch(t,"options",e)}async delete(t,e){return await this.fetch(t,"delete",e)}}const W=new C({});v.default=W;const ot={configure(s){const{context:t="default",...e}=s,o=new C(e);return v[t]=o,o},instance(s){if(["string","undefined"].includes(typeof s)){const t=s||"default",e=v[t];if(!e)throw Error("Invalid transport context: "+t);return e}else{const{fetch:t,context:e="default"}=s,o=v[e];if(!o)throw Error("Invalid transport context: "+e);return o.config.fetch=t,o}}};export{ot as T,st as a,_ as n,et as s};
